function p(e,t){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>{e.apply(this,i)},t)}}export default{LiveSelect:{textInput(){return this.el.querySelector("input[type=text]")},debounceMsec(){return parseInt(this.el.dataset.debounce)},updateMinLen(){return parseInt(this.el.dataset.updateMinLen)},maybeStyleClearButton(){const e=this.el.querySelector("button[phx-click=clear]");e&&(this.textInput().parentElement.style.position="relative",e.style.position="absolute",e.style.top="0px",e.style.bottom="0px",e.style.right="5px",e.style.display="block")},pushEventToParent(e,t){const s=this.el.dataset.phxTarget;s?this.pushEventTo(s,e,t):this.pushEvent(e,t)},attachDomEventHandlers(){this.textInput().onkeydown=t=>{this.keyboardMode==="server"?(t.code==="Enter"&&t.preventDefault(),this.pushEventTo(this.el,"keydown",{key:t.code})):this.keyboardMode==="hook"&&(t.key==="ArrowDown"?this.moveFocus(1,t):t.key==="ArrowUp"?this.moveFocus(-1,t):t.key==="Enter"?this.selectFocused(t):t.key==="Escape"&&this.handleEscape(t))},this.changeEvents=p((t,s,i)=>{this.pushEventTo(this.el,"change",{text:i}),this.pushEventToParent("live_select_change",{id:this.el.id,field:s,text:i})},this.debounceMsec()),this.textInput().oninput=t=>{const s=t.target.value.trim(),i=this.el.dataset.field;s.length>=this.updateMinLen()?this.changeEvents(this.el.id,i,s):this.pushEventTo(this.el,"options_clear",{})};const e=this.el.querySelector("ul");e&&(e.onmousedown=t=>{const s=t.target.closest("div[data-idx]");s&&(this.pushEventTo(this.el,"option_click",{idx:s.dataset.idx}),t.preventDefault())}),this.el.querySelectorAll("button[data-idx]").forEach(t=>{t.onclick=s=>{this.pushEventTo(this.el,"option_remove",{idx:t.dataset.idx})}})},dropdown(){return this.el.querySelector("ul")},getActiveOptionClasses(){return(this.el.dataset.activeOptionClasses||"").split(" ").filter(t=>t.trim()!=="")},moveFocus(e,t){t.preventDefault(),t.stopPropagation();const s=this.dropdown();if(!s)return;const i=s.querySelectorAll("div[data-idx]");if(!i.length)return;const n=Array.from(i);if(n.length===0)return;const l=this.getActiveOptionClasses();let o=-1;n.forEach((a,c)=>{l.some(d=>a.classList.contains(d))&&(o=c)});let r;e>0?r=o<n.length-1?o+1:0:r=o>0?o-1:n.length-1,n.forEach(a=>{l.forEach(c=>a.classList.remove(c))});const h=n[r];h&&(l.forEach(a=>h.classList.add(a)),h.scrollIntoView({block:"nearest"}),this.activeIdx=parseInt(h.dataset.idx))},selectFocused(e){e.preventDefault(),e.stopPropagation(),this.activeIdx!==void 0&&this.pushEventTo(this.el,"option_click",{idx:String(this.activeIdx)})},handleEscape(e){e.preventDefault(),e.stopPropagation(),this.pushEventTo(this.el,"keydown",{key:"Escape"})},setInputValue(e){this.textInput().value=e},inputEvent(e,t){const s=t==="single"?"input.single-mode":e.length===0?"input[data-live-select-empty]":"input[type=hidden]";this.el.querySelector(s).dispatchEvent(new Event("input",{bubbles:!0}))},mounted(){this.keyboardMode=this.el.dataset.keyboard||"server",this.maybeStyleClearButton(),this.handleEvent("parent_event",({id:e,event:t,payload:s})=>{this.el.id===e&&this.pushEventToParent(t,s)}),this.handleEvent("select",({id:e,selection:t,mode:s,current_text:i,input_event:n,parent_event:l})=>{if(this.el.id===e){if(this.selection=t,s==="single"){const o=t.length>0?t[0].label:i;this.setInputValue(o)}else this.setInputValue(i);n&&this.inputEvent(t,s),l&&this.pushEventToParent(l,{id:e})}}),this.handleEvent("active",({id:e,idx:t})=>{if(this.el.id===e){const s=this.el.querySelector(`div[data-idx="${t}"]`);s&&s.scrollIntoView({block:"nearest"})}}),this.attachDomEventHandlers()},updated(){this.keyboardMode=this.el.dataset.keyboard||"server",this.maybeStyleClearButton(),this.attachDomEventHandlers()},reconnected(){this.selection&&this.selection.length>0&&this.pushEventTo(this.el.id,"selection_recovery",this.selection)}}};
